# MVPLittlechat

一个功能完整的局域网聊天系统，支持多客户端连接，具有良好的用户体验和稳定性。

## 功能特点

### 客户端

#### 基础功能
- ✅ 支持连接到指定IP地址和端口
- ✅ 友好的GUI界面（提供tkinter和PyQt5两个版本）
- ✅ 实时聊天功能
- ✅ 支持发送和接收消息
- ✅ 显示自己发送的消息
- ✅ 支持回车键发送消息
- ✅ 自动滚动聊天记录
- ✅ 连接状态提示
- ✅ 错误处理和提示

#### PyQt5客户端增强功能
- ✅ 支持@提及功能，提及自己时高亮显示并弹窗提示
- ✅ 支持右键菜单查看用户资料
- ✅ 支持Gitee自动更新检测和下载
- ✅ 支持在连接前后检查更新
- ✅ 显示作者信息

### 服务端
- ✅ 运行在7891端口
- ✅ 支持多客户端连接
- ✅ 消息广播功能
- ✅ 新用户加入通知
- ✅ 用户离开通知
- ✅ 详细的日志记录
- ✅ 线程安全设计
- ✅ 完善的错误处理
- ✅ 自动处理客户端断开连接

## 系统要求

### 通用要求
- Python 3.6+

### client.py（tkinter版本）
- tkinter（Python标准库，通常已安装）

### client_pyqt5.py（PyQt5版本）
- PyQt5
- requests

## 安装依赖

对于PyQt5版本，需要安装以下依赖：

```bash
pip install PyQt5 requests
```

## 使用方法

### 1. 启动服务端

在命令行中运行：

```bash
python server.py
```

服务端将启动并监听7891端口，输出类似以下信息：

```
[2023-10-01 12:00:00] 聊天服务器已启动，正在监听端口 7891...
[2023-10-01 12:00:00] 服务器IP地址: 192.168.1.100
```

### 2. 启动客户端

#### 2.1 使用PyQt5版本（推荐）

在命令行中运行：

```bash
python client_pyqt5.py
```

或者直接双击`client_pyqt5.py`文件运行。

#### 2.2 使用tkinter版本

在命令行中运行：

```bash
python client.py
```

或者直接双击`client.py`文件运行。

### 3. 连接到服务器

1. 在客户端界面中，输入服务器的IP地址（默认为127.0.0.1）
2. 输入服务器端口（默认为7891）
3. 输入您的昵称
4. 点击"连接服务器"按钮
5. 连接成功后，进入聊天界面

### 4. 开始聊天

- 在输入框中输入消息，点击"发送"按钮或按回车键发送
- 聊天记录会显示在上方的文本区域
- 您发送的消息会显示为"我: 消息内容"
- 其他用户发送的消息会显示为"用户名: 消息内容"
- 系统消息会显示系统通知，如用户加入或离开

### 5. 使用特殊功能

#### 5.1 @提及功能
- 在聊天界面右侧用户列表中，右键点击用户，选择"@提及"
- 或者双击用户，自动在输入框中添加@用户名
- 当被@时，消息会高亮显示并弹出通知

#### 5.2 查看用户资料
- 在聊天界面右侧用户列表中，右键点击用户，选择"查看资料"
- 会显示该用户的昵称、IP地址、加入时间和操作系统版本

#### 5.3 检查更新（PyQt5版本）
- 在连接界面或聊天界面点击"检查更新"按钮
- 系统会检查Gitee仓库是否有新版本
- 如果有新版本，会显示更新通知，您可以选择立即更新

## 代码结构

### client_pyqt5.py（PyQt5客户端）

- `ChatClient`类: 聊天客户端主类
  - `__init__()`: 初始化客户端
  - `initUI()`: 创建用户界面
  - `connect_to_server()`: 连接到服务器
  - `send_message()`: 发送消息
  - `receive_messages()`: 接收消息
  - `check_for_updates()`: 检查Gitee更新
  - `download_latest_release()`: 下载最新版本

### client.py（tkinter客户端）

- `start_client()`: 主函数，创建GUI界面
- `create_connection_frame()`: 创建连接界面
- `create_nickname_frame()`: 创建昵称输入界面
- `setup_chat_interface()`: 创建聊天界面
- `send_message()`: 发送消息函数
- `receive_messages()`: 接收消息函数

### server.py（服务端）

- `ChatServer`类: 聊天服务器主类
  - `__init__()`: 初始化服务器
  - `handle_client()`: 处理单个客户端连接
  - `broadcast_message()`: 广播消息给所有客户端
  - `start()`: 启动服务器
  - `stop()`: 停止服务器

## 技术细节

- **网络通信**: 使用TCP套接字
- **并发处理**: 多线程技术，每个客户端一个线程
- **GUI框架**: 
  - PyQt5（推荐，功能更丰富）
  - tkinter（轻量级，无需额外安装）
- **线程安全**: 使用锁机制保护共享资源
- **错误处理**: 完善的异常捕获和处理
- **更新机制**: 通过Gitee API实现自动更新检测和下载

## 故障排除

### 客户端无法连接到服务器
- 检查服务器是否已启动
- 检查服务器IP地址和端口是否正确
- 检查防火墙设置，确保7891端口已开放
- 确保客户端和服务器在同一局域网内

### 消息发送失败
- 检查网络连接是否正常
- 检查服务器是否仍在运行
- 检查客户端是否已断开连接

### 检查更新失败
- 检查网络连接是否正常
- 确保您的网络可以访问Gitee网站
- 检查Gitee API Token是否有效

## 许可证

MIT License

## 作者

MVPS680

## 更新日志

### v2.1.0
- 新增PyQt5客户端
- 新增@提及功能
- 新增用户资料查看功能
- 新增Gitee自动更新检测功能
- 新增作者信息显示
- 优化聊天界面设计
- 完善错误处理机制

### v1.0.0
- 初始版本
- 支持基本的聊天功能
- 支持多客户端连接
- 友好的GUI界面
- 完善的错误处理